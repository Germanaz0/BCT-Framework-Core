<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>BarcampTransparency: /home/icewing/Workingdirectory/bct_netbeans/bctplatform/engine/lib/data.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<h1>/home/icewing/Workingdirectory/bct_netbeans/bctplatform/engine/lib/data.php</h1><a href="data_8php.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00032"></a><a class="code" href="classBCTObject.html">00032</a>         <span class="keyword">abstract</span> <span class="keyword">class </span><a class="code" href="classBCTObject.html" title="Barcamp Transparency Object.">BCTObject</a> <span class="keyword">implements</span>
<a name="l00033"></a>00033                 Iterator,       <span class="comment">// Override foreach behaviour</span>
<a name="l00034"></a>00034                 ArrayAccess <span class="comment">// Override for array access</span>
<a name="l00035"></a>00035         {
<a name="l00039"></a>00039                 <span class="keyword">private</span> $__attributes = array();
<a name="l00040"></a>00040                 
<a name="l00045"></a>00045                 <span class="keyword">private</span> $__type_hierarchy = array();
<a name="l00046"></a>00046                 
<a name="l00052"></a>00052                 <span class="keyword">private</span> $__type = null;
<a name="l00053"></a>00053 
<a name="l00057"></a>00057                 <span class="keyword">private</span> $__attributes_modified = <span class="keyword">false</span>;
<a name="l00058"></a>00058                 
<a name="l00064"></a>00064                 <span class="keyword">private</span> $guid = null;
<a name="l00065"></a>00065                 
<a name="l00069"></a>00069                 <span class="keyword">private</span> $created_ts = null;
<a name="l00070"></a>00070                 
<a name="l00071"></a><a class="code" href="classBCTObject.html#abb41b231d714f624209083040ae56c34">00071</a>                 <span class="keyword">public</span> function <a class="code" href="classBCTObject.html#abb41b231d714f624209083040ae56c34">__construct</a>() {}
<a name="l00072"></a>00072                 
<a name="l00078"></a><a class="code" href="classBCTObject.html#a776243ff928a9e80bd13b61fc05b685b">00078</a>                 <span class="keyword">public</span> function <a class="code" href="classBCTObject.html#a776243ff928a9e80bd13b61fc05b685b" title="Return a GUID.">getGUID</a>() { <span class="keywordflow">return</span> $this-&gt;guid; }
<a name="l00079"></a>00079                 
<a name="l00085"></a><a class="code" href="classBCTObject.html#afc6ad3098c1628e5349575a4eb085d3e">00085</a>                 <span class="keyword">public</span> function <a class="code" href="classBCTObject.html#afc6ad3098c1628e5349575a4eb085d3e" title="Return a unix timestamp for when the object was created, blank if not saved.">getCreatedTs</a>() { <span class="keywordflow">return</span> $this-&gt;created_ts; }
<a name="l00086"></a>00086                 
<a name="l00092"></a><a class="code" href="classBCTObject.html#af1c2c1c5a5106cc161c70a0aeeee024f">00092</a>                 <span class="keyword">public</span> function <a class="code" href="classBCTObject.html#af1c2c1c5a5106cc161c70a0aeeee024f" title="Return the full type hierarchy of this object.">getTypeHierarchy</a>() { <span class="keywordflow">return</span> implode(<span class="charliteral">&apos;:&apos;</span>, $this-&gt;__type_hierarchy); }
<a name="l00093"></a>00093                 
<a name="l00102"></a><a class="code" href="classBCTObject.html#aadd971af998350999c69c372e2d7027b">00102</a>                 <span class="keyword">protected</span> function <a class="code" href="classBCTObject.html#aadd971af998350999c69c372e2d7027b" title="Add a type to the type hierarchy.">setType</a>($type) 
<a name="l00103"></a>00103                 {       
<a name="l00104"></a>00104                         $this-&gt;__type = $type; 
<a name="l00105"></a>00105                         $this-&gt;__type_hierarchy[] = $type; 
<a name="l00106"></a>00106                 }
<a name="l00107"></a>00107                 
<a name="l00114"></a><a class="code" href="classBCTObject.html#ac1ae211c798a9860b7cb46a170b076ef">00114</a>                 <span class="keyword">public</span> function &amp;<a class="code" href="classBCTObject.html#ac1ae211c798a9860b7cb46a170b076ef" title="Class member get overloading.">__get</a>(<a class="code" href="input_2formbody_8php.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a>) {
<a name="l00115"></a>00115                         
<a name="l00116"></a>00116                         <span class="comment">// Give read only access to some vars, TODO: do this generically.</span>
<a name="l00117"></a>00117                         <span class="keywordflow">if</span> (<a class="code" href="input_2formbody_8php.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a>==<span class="stringliteral">&apos;guid&apos;</span>) 
<a name="l00118"></a>00118                                 <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classBCTObject.html#a776243ff928a9e80bd13b61fc05b685b" title="Return a GUID.">getGUID</a>(); 
<a name="l00119"></a>00119                         <span class="keywordflow">if</span> (<a class="code" href="input_2formbody_8php.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a>==<span class="stringliteral">&apos;created_ts&apos;</span>)
<a name="l00120"></a>00120                                 <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classBCTObject.html#afc6ad3098c1628e5349575a4eb085d3e" title="Return a unix timestamp for when the object was created, blank if not saved.">getCreatedTs</a>();
<a name="l00121"></a>00121                                  
<a name="l00122"></a>00122                         <span class="keywordflow">if</span> (isset($this-&gt;__attributes[<a class="code" href="input_2formbody_8php.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a>]))
<a name="l00123"></a>00123                                 <span class="keywordflow">return</span> $this-&gt;__attributes[$name];
<a name="l00124"></a>00124 
<a name="l00125"></a>00125                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00126"></a>00126                 }
<a name="l00127"></a>00127                 
<a name="l00135"></a><a class="code" href="classBCTObject.html#a1ded3787b6f9117e77c5f869b0a434a3">00135</a>                 <span class="keyword">public</span> function <a class="code" href="classBCTObject.html#a1ded3787b6f9117e77c5f869b0a434a3" title="Class member set overloading.">__set</a>(<a class="code" href="input_2formbody_8php.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a>, <a class="code" href="input_2date_8php.html#a0f298096f322952a72a50f98a74c7b60">$value</a>) {
<a name="l00136"></a>00136                         <span class="comment">// Safety TODO: Handle more generically</span>
<a name="l00137"></a>00137                         <span class="keywordflow">if</span> (<a class="code" href="input_2formbody_8php.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a> == <span class="stringliteral">&apos;guid&apos;</span>)
<a name="l00138"></a>00138                                 <span class="keywordflow">return</span>; <span class="comment">// won&apos;t set guid</span>
<a name="l00139"></a>00139                                 
<a name="l00140"></a>00140                         <span class="keywordflow">if</span> (<a class="code" href="input_2formbody_8php.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a> == <span class="stringliteral">&apos;created_ts&apos;</span>) { <span class="comment">// can set create time</span>
<a name="l00141"></a>00141                                 $this-&gt;created_ts = <a class="code" href="input_2date_8php.html#a0f298096f322952a72a50f98a74c7b60">$value</a>;
<a name="l00142"></a>00142                                 
<a name="l00143"></a>00143                                 <span class="keywordflow">return</span>;
<a name="l00144"></a>00144                         }
<a name="l00145"></a>00145 
<a name="l00146"></a>00146                         <span class="comment">// Otherwise this is metadata</span>
<a name="l00147"></a>00147                         $this-&gt;__attributes_modified = <span class="keyword">true</span>;
<a name="l00148"></a>00148                         <span class="keywordflow">return</span> $this-&gt;__attributes[<a class="code" href="input_2formbody_8php.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a>] = <a class="code" href="input_2date_8php.html#a0f298096f322952a72a50f98a74c7b60">$value</a>; 
<a name="l00149"></a>00149                 }
<a name="l00150"></a>00150                 
<a name="l00157"></a><a class="code" href="classBCTObject.html#a4739bc057a954661c2bedd373645fc38">00157</a>                 <span class="keyword">public</span> function <a class="code" href="classBCTObject.html#a4739bc057a954661c2bedd373645fc38" title="Supporting isset.">__isset</a>(<a class="code" href="input_2formbody_8php.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a>) { <span class="keywordflow">return</span> isset($this-&gt;__attributes[<a class="code" href="input_2formbody_8php.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a>]); }
<a name="l00158"></a>00158                 
<a name="l00164"></a><a class="code" href="classBCTObject.html#a0ee5994b188bc9402ad49542484c3dfb">00164</a>                 <span class="keyword">public</span> function <a class="code" href="classBCTObject.html#a0ee5994b188bc9402ad49542484c3dfb" title="Supporting unsetting of magic attributes.">__unset</a>(<a class="code" href="input_2formbody_8php.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a>) { unset($this-&gt;__attributes[<a class="code" href="input_2formbody_8php.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a>]); }
<a name="l00165"></a>00165                 
<a name="l00171"></a><a class="code" href="classBCTObject.html#a79fa18e1f0f6fa3ed5ad2bf548770296">00171</a>                 <span class="keyword">public</span> function <a class="code" href="classBCTObject.html#a79fa18e1f0f6fa3ed5ad2bf548770296" title="Render this object.">draw</a>(array <a class="code" href="default_2data_2lists_2____default_8php.html#a951ef573c9008ec18012f88a5c78b209">$vars</a> = null)
<a name="l00172"></a>00172                 {
<a name="l00173"></a>00173                         <span class="keywordflow">if</span> (!<a class="code" href="default_2data_2lists_2____default_8php.html#a951ef573c9008ec18012f88a5c78b209">$vars</a>) <a class="code" href="default_2data_2lists_2____default_8php.html#a951ef573c9008ec18012f88a5c78b209">$vars</a> = array();
<a name="l00174"></a>00174                         <a class="code" href="default_2data_2lists_2____default_8php.html#a951ef573c9008ec18012f88a5c78b209">$vars</a>[<span class="stringliteral">&apos;item&apos;</span>] = $this;
<a name="l00175"></a>00175                         
<a name="l00176"></a>00176                         <a class="code" href="default_2exceptions_2____default_8php.html#a252ba022809910ea710a068fc1bab657">$class</a> = strtolower(get_class($this));
<a name="l00177"></a>00177                         
<a name="l00178"></a>00178                         $content = <a class="code" href="output_8php.html#a73f7c0d588ceab42b328a5e0eca915cf" title="Render a view.">view</a>(<span class="stringliteral">&quot;data/items/$class&quot;</span>, <a class="code" href="default_2data_2lists_2____default_8php.html#a951ef573c9008ec18012f88a5c78b209">$vars</a>);
<a name="l00179"></a>00179                         <span class="keywordflow">if</span> ($content) 
<a name="l00180"></a>00180                                 <span class="keywordflow">return</span> $content;
<a name="l00181"></a>00181                                 
<a name="l00182"></a>00182                         $content = <a class="code" href="output_8php.html#a73f7c0d588ceab42b328a5e0eca915cf" title="Render a view.">view</a>(<span class="stringliteral">&apos;data/items/__default&apos;</span>, <a class="code" href="default_2data_2lists_2____default_8php.html#a951ef573c9008ec18012f88a5c78b209">$vars</a>);
<a name="l00183"></a>00183                         <span class="keywordflow">if</span> ($content) 
<a name="l00184"></a>00184                                 <span class="keywordflow">return</span> $content;
<a name="l00185"></a>00185                                 
<a name="l00186"></a>00186                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00187"></a>00187                 }
<a name="l00188"></a>00188                                 
<a name="l00195"></a><a class="code" href="classBCTObject.html#aeaa2d37bd4df82ef247f5bff56fa2ff4">00195</a>                 <span class="keyword">public</span> function <a class="code" href="classBCTObject.html#aeaa2d37bd4df82ef247f5bff56fa2ff4" title="Render an object using the views system (using default values).">__toString</a>() { <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classBCTObject.html#a79fa18e1f0f6fa3ed5ad2bf548770296" title="Render this object.">draw</a>(); }
<a name="l00196"></a>00196                 
<a name="l00201"></a><a class="code" href="classBCTObject.html#a4f01167e1b7d3d7c00bab784a1cd8130">00201</a>                 <span class="keyword">public</span> function <a class="code" href="classBCTObject.html#a4f01167e1b7d3d7c00bab784a1cd8130" title="Return a copy of this object which is safe to export, that is that it has security...">safeExport</a>()
<a name="l00202"></a>00202                 {
<a name="l00203"></a>00203                     <a class="code" href="json_2data_2items_2____default_8php.html#a9ed100a2016087d17416f88e05ffe4b6">$export</a> = <span class="keyword">new</span> stdClass();
<a name="l00204"></a>00204 
<a name="l00205"></a>00205                     <span class="keywordflow">foreach</span> ($this as $field =&gt; <a class="code" href="input_2date_8php.html#a0f298096f322952a72a50f98a74c7b60">$value</a>)
<a name="l00206"></a>00206                         <a class="code" href="json_2data_2items_2____default_8php.html#a9ed100a2016087d17416f88e05ffe4b6">$export</a>-&gt;$field = <a class="code" href="input_2date_8php.html#a0f298096f322952a72a50f98a74c7b60">$value</a>;
<a name="l00207"></a>00207 
<a name="l00208"></a>00208 
<a name="l00209"></a>00209                     <a class="code" href="json_2data_2items_2____default_8php.html#a9ed100a2016087d17416f88e05ffe4b6">$export</a>-&gt;url = $this-&gt;getURL(); <span class="comment">// Everything has a URL, so add it</span>
<a name="l00210"></a>00210 
<a name="l00211"></a>00211                     <span class="keywordflow">return</span> <a class="code" href="json_2data_2items_2____default_8php.html#a9ed100a2016087d17416f88e05ffe4b6">$export</a>;
<a name="l00212"></a>00212                 }
<a name="l00213"></a>00213 
<a name="l00226"></a><a class="code" href="classBCTObject.html#a0ca3ddd0ca1b6c77426ea52ba0e6d35f">00226</a>                 <span class="keyword">public</span> function <a class="code" href="classBCTObject.html#a0ca3ddd0ca1b6c77426ea52ba0e6d35f" title="Get an object URL.">getUrl</a>()
<a name="l00227"></a>00227                 {
<a name="l00228"></a>00228                         global <a class="code" href="settings_8example_8php.html#ac32a9d18d73c87d99cdc0547a6c43904" title="Create the CONFIG object.">$CONFIG</a>;
<a name="l00229"></a>00229                         
<a name="l00230"></a>00230                         <span class="keywordflow">if</span> (!$this-&gt;guid) 
<a name="l00231"></a>00231                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00232"></a>00232                                 
<a name="l00233"></a>00233                         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classBCTObject.html#a905fcf00039673c6d1707c1a03de46b1" title="Helper method for triggering object related hooks.">__send_object_hook</a>(<span class="stringliteral">&apos;property:url&apos;</span>, <span class="stringliteral">&quot;{$CONFIG-&gt;wwwroot}object/{$this-&gt;guid}&quot;</span>);
<a name="l00234"></a>00234                 }
<a name="l00235"></a>00235                 
<a name="l00244"></a><a class="code" href="classBCTObject.html#a7a1eecbe3f965378c9333220d6b8f556">00244</a>                 <span class="keyword">public</span> function <a class="code" href="classBCTObject.html#a7a1eecbe3f965378c9333220d6b8f556" title="Return an icon for the object.">getIcon</a>($size = <span class="stringliteral">&apos;small&apos;</span>)
<a name="l00245"></a>00245                 {
<a name="l00246"></a>00246                         global <a class="code" href="settings_8example_8php.html#ac32a9d18d73c87d99cdc0547a6c43904" title="Create the CONFIG object.">$CONFIG</a>;
<a name="l00247"></a>00247                         
<a name="l00248"></a>00248                         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classBCTObject.html#a905fcf00039673c6d1707c1a03de46b1" title="Helper method for triggering object related hooks.">__send_object_hook</a>(<span class="stringliteral">&apos;property:icon&apos;</span>, <span class="stringliteral">&apos;&apos;</span>, array(<span class="stringliteral">&apos;size&apos;</span> =&gt; $size)); <span class="comment">// TODO: Return default icon..? </span>
<a name="l00249"></a>00249                 }
<a name="l00250"></a>00250                 
<a name="l00259"></a><a class="code" href="classBCTObject.html#ae3b57b92978ae37a617a887dcc518c85">00259</a>                 <span class="keyword">public</span> function <a class="code" href="classBCTObject.html#ae3b57b92978ae37a617a887dcc518c85" title="Can this object be edited.">canEdit</a>(<a class="code" href="classUser.html" title="Basic user class.">User</a> $user = null) { <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classBCTObject.html#a905fcf00039673c6d1707c1a03de46b1" title="Helper method for triggering object related hooks.">__send_object_hook</a>(<span class="stringliteral">&apos;canedit&apos;</span>, <span class="keyword">false</span>, array(<span class="stringliteral">&apos;user&apos;</span> =&gt; $user ? $user : <a class="code" href="user_8php.html#ae3c831306b611b9d714ea840d5342d34" title="Get the currently logged in user.">user_get_current</a>())); }
<a name="l00260"></a>00260                 
<a name="l00273"></a><a class="code" href="classBCTObject.html#a8bb4a655fe81dd2798aeb16cf2bdde71">00273</a>                 <span class="keyword">public</span> function <a class="code" href="classBCTObject.html#a8bb4a655fe81dd2798aeb16cf2bdde71" title="Can this object be viewed?">canView</a>(<a class="code" href="classUser.html" title="Basic user class.">User</a> $user = null) { <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classBCTObject.html#a905fcf00039673c6d1707c1a03de46b1" title="Helper method for triggering object related hooks.">__send_object_hook</a>(<span class="stringliteral">&apos;canview&apos;</span>, <span class="keyword">true</span>, array(<span class="stringliteral">&apos;user&apos;</span> =&gt; $user ? $user : <a class="code" href="user_8php.html#ae3c831306b611b9d714ea840d5342d34" title="Get the currently logged in user.">user_get_current</a>())); }
<a name="l00274"></a>00274                 
<a name="l00279"></a><a class="code" href="classBCTObject.html#af048b27100b72570359d9af35ecdc50e">00279</a>                 <span class="keyword">public</span> function <a class="code" href="classBCTObject.html#af048b27100b72570359d9af35ecdc50e" title="Save entity to database.">save</a>()
<a name="l00280"></a>00280                 {
<a name="l00281"></a>00281                         global <a class="code" href="settings_8example_8php.html#ac32a9d18d73c87d99cdc0547a6c43904" title="Create the CONFIG object.">$CONFIG</a>;
<a name="l00282"></a>00282                         
<a name="l00283"></a>00283                         $guid = (int) $this-&gt;guid;
<a name="l00284"></a>00284                         $update = <span class="keyword">false</span>;
<a name="l00285"></a>00285                         <span class="keywordflow">if</span> ($guid)
<a name="l00286"></a>00286                                 $update = <span class="keyword">true</span>;
<a name="l00287"></a>00287                                 
<a name="l00288"></a>00288                         <span class="comment">// Test for type</span>
<a name="l00289"></a>00289                         <span class="keywordflow">if</span> (!$this-&gt;__type)
<a name="l00290"></a>00290                                 <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classClassException.html">ClassException</a>(sprintf(<a class="code" href="language_8php.html#af6dcae4ee39a314ee7d9b340ee789820" title="Echo a translated string.">_echo</a>(<span class="stringliteral">&apos;class:exception:missingtype&apos;</span>), get_class($this)));
<a name="l00291"></a>00291                                 
<a name="l00292"></a>00292                         <span class="comment">// Trigger pre event, block creation/update if pre returns false </span>
<a name="l00293"></a>00293                         <span class="comment">// (doing this means we don&apos;t have to do any messy delete/reset </span>
<a name="l00294"></a>00294                         <span class="comment">// stuff if an event action blocks)</span>
<a name="l00295"></a>00295                         <span class="keywordflow">if</span> (!$this-&gt;<a class="code" href="classBCTObject.html#a3293d3a72bdc82a3d04be79153406e5f" title="Helper method for sending object related events.">__send_object_event</a>($update ? <span class="stringliteral">&apos;updating&apos;</span> : <span class="stringliteral">&apos;saving&apos;</span>))
<a name="l00296"></a>00296                                 <span class="keywordflow">return</span> <span class="keyword">false</span>; 
<a name="l00297"></a>00297                                 
<a name="l00298"></a>00298                         <span class="comment">// Update or save?</span>
<a name="l00299"></a>00299                         <span class="keywordflow">if</span> ($guid &gt; 0) 
<a name="l00300"></a>00300                         {
<a name="l00301"></a>00301                                 
<a name="l00302"></a>00302                                 <span class="comment">// No need to update main entity atm since there are no fields to update</span>
<a name="l00303"></a>00303                                 
<a name="l00304"></a>00304                                 
<a name="l00305"></a>00305                                 
<a name="l00306"></a>00306                                 <span class="comment">// Delete metadata if we need to update</span>
<a name="l00307"></a>00307                                 <span class="keywordflow">if</span> ($this-&gt;__attributes_modified) {
<a name="l00308"></a>00308                                     <a class="code" href="action__handler_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a> = <a class="code" href="database_8php.html#ae3fd1d682e07f96c0f2c711f5406dda9" title="Delete data from the database, returning the number of affected rows.">db_delete_data</a>(
<a name="l00309"></a>00309                                             array (
<a name="l00310"></a>00310                                                     <span class="stringliteral">&apos;table_col&apos;</span> =&gt; <span class="stringliteral">&quot;{$CONFIG-&gt;dbprefix}bctobjects_metadata&quot;</span>,
<a name="l00311"></a>00311                                                     <span class="stringliteral">&apos;where&apos;</span> =&gt; <span class="stringliteral">&apos;guid=&apos;</span>.(<span class="keywordtype">int</span>)$guid
<a name="l00312"></a>00312                                             )
<a name="l00313"></a>00313                                     );
<a name="l00314"></a>00314                                 }
<a name="l00315"></a>00315                         }
<a name="l00316"></a>00316                         <span class="keywordflow">else</span>
<a name="l00317"></a>00317                         {
<a name="l00318"></a>00318                                 <span class="comment">// If time not set then use the current time, this lets you </span>
<a name="l00319"></a>00319                                 <span class="comment">// set times which are in the past or future on creation.</span>
<a name="l00320"></a>00320                                 $time = $this-&gt;created_ts;
<a name="l00321"></a>00321                                 <span class="keywordflow">if</span> (!$time)
<a name="l00322"></a>00322                                         $time = time();
<a name="l00323"></a>00323                                 
<a name="l00324"></a>00324                                 <span class="comment">// Create new entity</span>
<a name="l00325"></a>00325                                 $guid = <a class="code" href="database_8php.html#ac25bed05936939bb35ddf3dc27521918" title="Insert data into a database according to given parameters.">db_insert_data</a>(
<a name="l00326"></a>00326                                         array ( 
<a name="l00327"></a>00327                                                 <span class="stringliteral">&apos;table_col&apos;</span> =&gt; <span class="stringliteral">&quot;{$CONFIG-&gt;dbprefix}bctobjects&quot;</span>,
<a name="l00328"></a>00328                                                 <span class="stringliteral">&apos;set_values&apos;</span> =&gt; array (
<a name="l00329"></a>00329                                                         <span class="stringliteral">&apos;type=&quot;&apos;</span>.$this-&gt;<a class="code" href="classBCTObject.html#af1c2c1c5a5106cc161c70a0aeeee024f" title="Return the full type hierarchy of this object.">getTypeHierarchy</a>().<span class="charliteral">&apos;&quot;&apos;</span>,
<a name="l00330"></a>00330                                                         <span class="stringliteral">&apos;handling_class=&quot;&apos;</span>.get_class($this).<span class="charliteral">&apos;&quot;&apos;</span>,
<a name="l00331"></a>00331                                                         <span class="stringliteral">&apos;created_ts=&quot;&apos;</span>.$time.<span class="charliteral">&apos;&quot;&apos;</span>
<a name="l00332"></a>00332                                                 )
<a name="l00333"></a>00333                                         )
<a name="l00334"></a>00334                                 );
<a name="l00335"></a>00335                                 
<a name="l00336"></a>00336                                 <span class="comment">// Set guid </span>
<a name="l00337"></a>00337                                 $this-&gt;guid = $guid;
<a name="l00338"></a>00338                                 
<a name="l00339"></a>00339                                 <span class="comment">// Timestamp</span>
<a name="l00340"></a>00340                                 $this-&gt;created_ts = $time;
<a name="l00341"></a>00341                         }
<a name="l00342"></a>00342                         
<a name="l00343"></a>00343                         <span class="comment">// Save metadata if guid there</span>
<a name="l00344"></a>00344                         <span class="keywordflow">if</span> (($guid) &amp;&amp; ($this-&gt;__attributes_modified))
<a name="l00345"></a>00345                         {
<a name="l00346"></a>00346                                 <span class="comment">// Set metadata</span>
<a name="l00347"></a>00347                                 <span class="keywordflow">foreach</span> ($this-&gt;__attributes as $key =&gt; <a class="code" href="input_2date_8php.html#a0f298096f322952a72a50f98a74c7b60">$value</a>)
<a name="l00348"></a>00348                                 {
<a name="l00349"></a>00349                                         <span class="comment">// Sanitise string</span>
<a name="l00350"></a>00350                                         $key = <a class="code" href="database_8php.html#a0d86f7dc87033ca8db5e4ad4765150fc" title="Sanitise a string for database use.">sanitise_string</a>($key);
<a name="l00351"></a>00351                                         
<a name="l00352"></a>00352                                         <span class="comment">// Convert non-array to array </span>
<a name="l00353"></a>00353                                         <span class="keywordflow">if</span> (!is_array(<a class="code" href="input_2date_8php.html#a0f298096f322952a72a50f98a74c7b60">$value</a>))
<a name="l00354"></a>00354                                                 <a class="code" href="input_2date_8php.html#a0f298096f322952a72a50f98a74c7b60">$value</a> = array(<a class="code" href="input_2date_8php.html#a0f298096f322952a72a50f98a74c7b60">$value</a>);
<a name="l00355"></a>00355                                         
<a name="l00356"></a>00356                                         <span class="comment">// Save metadata</span>
<a name="l00357"></a>00357                                         <span class="keywordflow">foreach</span> (<a class="code" href="input_2date_8php.html#a0f298096f322952a72a50f98a74c7b60">$value</a> as $meta)
<a name="l00358"></a>00358                                         {
<a name="l00359"></a>00359                                                 <a class="code" href="database_8php.html#ac25bed05936939bb35ddf3dc27521918" title="Insert data into a database according to given parameters.">db_insert_data</a>(
<a name="l00360"></a>00360                                                         array ( 
<a name="l00361"></a>00361                                                                 <span class="stringliteral">&apos;table_col&apos;</span> =&gt; <span class="stringliteral">&quot;{$CONFIG-&gt;dbprefix}bctobjects_metadata&quot;</span>,
<a name="l00362"></a>00362                                                                 <span class="stringliteral">&apos;set_values&apos;</span> =&gt; array (
<a name="l00363"></a>00363                                                                         <span class="stringliteral">&apos;guid=&apos;</span>.(<span class="keywordtype">int</span>)$guid,
<a name="l00364"></a>00364                                                                         <span class="stringliteral">&apos;name=&quot;&apos;</span>.$key.<span class="charliteral">&apos;&quot;&apos;</span>,
<a name="l00365"></a>00365                                                                         <span class="stringliteral">&apos;value=&quot;&apos;</span>.sanitise_string($meta).<span class="charliteral">&apos;&quot;&apos;</span>
<a name="l00366"></a>00366                                                                 )
<a name="l00367"></a>00367                                                         )
<a name="l00368"></a>00368                                                 );
<a name="l00369"></a>00369                                         }
<a name="l00370"></a>00370                                 }
<a name="l00371"></a>00371 
<a name="l00372"></a>00372                                 $this-&gt;__attributes_modified = <span class="keyword">false</span>;
<a name="l00373"></a>00373                         }
<a name="l00374"></a>00374                         
<a name="l00375"></a>00375                         <span class="comment">// Saved, so trigger save event</span>
<a name="l00376"></a>00376                         <span class="keywordflow">if</span> ($guid)
<a name="l00377"></a>00377                                 $this-&gt;<a class="code" href="classBCTObject.html#a3293d3a72bdc82a3d04be79153406e5f" title="Helper method for sending object related events.">__send_object_event</a>($update ? <span class="stringliteral">&apos;updated&apos;</span> : <span class="stringliteral">&apos;saved&apos;</span>);
<a name="l00378"></a>00378                         
<a name="l00379"></a>00379                         <span class="keywordflow">return</span> $guid;
<a name="l00380"></a>00380                 }
<a name="l00381"></a>00381                 
<a name="l00382"></a>00382                 
<a name="l00392"></a><a class="code" href="classBCTObject.html#aadda1a8549d3a0532ba4404e629b71db">00392</a>                 <span class="keyword">public</span> function <a class="code" href="classBCTObject.html#aadda1a8549d3a0532ba4404e629b71db" title="Construct a BCT Object from a row.">loadFromRow</a>(stdClass $row)
<a name="l00393"></a>00393                 {
<a name="l00394"></a>00394                         global <a class="code" href="settings_8example_8php.html#ac32a9d18d73c87d99cdc0547a6c43904" title="Create the CONFIG object.">$CONFIG</a>;
<a name="l00395"></a>00395         
<a name="l00396"></a>00396                         <span class="comment">// Sanity check, make sure we&apos;re not being called incorrectly</span>
<a name="l00397"></a>00397                         <span class="keywordflow">if</span> (
<a name="l00398"></a>00398                                 (!($row instanceof stdClass)) ||
<a name="l00399"></a>00399                                 (!$row-&gt;guid) ||
<a name="l00400"></a>00400                                 (!$row-&gt;handling_class)
<a name="l00401"></a>00401                         )       
<a name="l00402"></a>00402                                 <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classClassException.html">ClassException</a>(<a class="code" href="language_8php.html#af6dcae4ee39a314ee7d9b340ee789820" title="Echo a translated string.">_echo</a>(<span class="stringliteral">&apos;class:exception:invalidrow&apos;</span>));
<a name="l00403"></a>00403                                 
<a name="l00404"></a>00404                         <span class="comment">// Populate from row</span>
<a name="l00405"></a>00405                         $this-&gt;created_ts = $row-&gt;created_ts;
<a name="l00406"></a>00406                         $this-&gt;guid = $row-&gt;guid;
<a name="l00407"></a>00407                         
<a name="l00408"></a>00408                         <span class="comment">// Populate from metadata</span>
<a name="l00409"></a>00409                         $metadata = <a class="code" href="database_8php.html#a661228a8074ffb96cc1db01f064f0f64" title="Return a query with multiple return results.">db_getdata</a>(
<a name="l00410"></a>00410                                 array (
<a name="l00411"></a>00411                                         <span class="stringliteral">&apos;select_expr&apos;</span> =&gt; <span class="charliteral">&apos;*&apos;</span>,
<a name="l00412"></a>00412                                         <span class="stringliteral">&apos;table_col&apos;</span> =&gt; <span class="stringliteral">&quot;{$CONFIG-&gt;dbprefix}bctobjects_metadata&quot;</span>,
<a name="l00413"></a>00413                                         <span class="stringliteral">&apos;where&apos;</span> =&gt; <span class="stringliteral">&apos;guid=&apos;</span> . (<span class="keywordtype">int</span>)$this-&gt;guid
<a name="l00414"></a>00414                                 )
<a name="l00415"></a>00415                         );
<a name="l00416"></a>00416 
<a name="l00417"></a>00417                         <span class="keywordflow">if</span> ($metadata)
<a name="l00418"></a>00418                         {
<a name="l00419"></a>00419                                 <span class="keywordflow">foreach</span> ($metadata as $md)
<a name="l00420"></a>00420                                 {
<a name="l00421"></a>00421                                         <a class="code" href="input_2formbody_8php.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a> = $md-&gt;name;
<a name="l00422"></a>00422                                         <a class="code" href="input_2date_8php.html#a0f298096f322952a72a50f98a74c7b60">$value</a> = $md-&gt;value;
<a name="l00423"></a>00423                                 
<a name="l00424"></a>00424                                         <span class="comment">// If already set, turn existing value into array</span>
<a name="l00425"></a>00425                                         <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="input_2formbody_8php.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a>) 
<a name="l00426"></a>00426                                         {
<a name="l00427"></a>00427                                                 <span class="keywordflow">if</span> (!is_array($this-&gt;<a class="code" href="input_2formbody_8php.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a>))
<a name="l00428"></a>00428                                                         $tmp = array($this-&gt;<a class="code" href="input_2formbody_8php.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a>);
<a name="l00429"></a>00429                                                 <span class="keywordflow">else</span>
<a name="l00430"></a>00430                                                         $tmp = $this-&gt;<a class="code" href="input_2formbody_8php.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a>;
<a name="l00431"></a>00431                                                 $tmp[] = <a class="code" href="input_2date_8php.html#a0f298096f322952a72a50f98a74c7b60">$value</a>;
<a name="l00432"></a>00432                                                 $this-&gt;<a class="code" href="input_2formbody_8php.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a> = $tmp;
<a name="l00433"></a>00433                                         }       
<a name="l00434"></a>00434                                         <span class="keywordflow">else</span>
<a name="l00435"></a>00435                                                 $this-&gt;<a class="code" href="input_2formbody_8php.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a> = <a class="code" href="input_2date_8php.html#a0f298096f322952a72a50f98a74c7b60">$value</a>;
<a name="l00436"></a>00436                                         
<a name="l00437"></a>00437                                 }
<a name="l00438"></a>00438                         }
<a name="l00439"></a>00439                         
<a name="l00440"></a>00440                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00441"></a>00441                 }
<a name="l00442"></a>00442                 
<a name="l00448"></a><a class="code" href="classBCTObject.html#a6c2d7244af499f8ecc2b011a3732683f">00448</a>                 <span class="keyword">public</span> function <span class="keyword">delete</span>()
<a name="l00449"></a>00449                 {
<a name="l00450"></a>00450                         global <a class="code" href="settings_8example_8php.html#ac32a9d18d73c87d99cdc0547a6c43904" title="Create the CONFIG object.">$CONFIG</a>;
<a name="l00451"></a>00451                         
<a name="l00452"></a>00452                         <span class="comment">// Not saved, so can&apos;t delete</span>
<a name="l00453"></a>00453                         <span class="keywordflow">if</span> (!$this-&gt;guid)
<a name="l00454"></a>00454                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00455"></a>00455                                 
<a name="l00456"></a>00456                         <span class="comment">// Trigger pre-delete</span>
<a name="l00457"></a>00457                         <span class="keywordflow">if</span> (!$this-&gt;<a class="code" href="classBCTObject.html#a3293d3a72bdc82a3d04be79153406e5f" title="Helper method for sending object related events.">__send_object_event</a>(<span class="stringliteral">&apos;deleting&apos;</span>))
<a name="l00458"></a>00458                                 <span class="keywordflow">return</span> <span class="keyword">false</span>; 
<a name="l00459"></a>00459                                 
<a name="l00460"></a>00460                         <span class="comment">// Delete data</span>
<a name="l00461"></a>00461                         <span class="keywordflow">if</span> (<a class="code" href="database_8php.html#ae3fd1d682e07f96c0f2c711f5406dda9" title="Delete data from the database, returning the number of affected rows.">db_delete_data</a>(
<a name="l00462"></a>00462                                 array (
<a name="l00463"></a>00463                                         <span class="stringliteral">&apos;table_col&apos;</span> =&gt; <span class="stringliteral">&quot;{$CONFIG-&gt;dbprefix}bctobjects&quot;</span>,
<a name="l00464"></a>00464                                         <span class="stringliteral">&apos;where&apos;</span> =&gt; <span class="stringliteral">&apos;guid=&apos;</span> . (<span class="keywordtype">int</span>)$this-&gt;guid
<a name="l00465"></a>00465                                 )
<a name="l00466"></a>00466                         ))
<a name="l00467"></a>00467                         {
<a name="l00468"></a>00468                                 $meta = <a class="code" href="database_8php.html#ae3fd1d682e07f96c0f2c711f5406dda9" title="Delete data from the database, returning the number of affected rows.">db_delete_data</a>(
<a name="l00469"></a>00469                                         array (
<a name="l00470"></a>00470                                                 <span class="stringliteral">&apos;table_col&apos;</span> =&gt; <span class="stringliteral">&quot;{$CONFIG-&gt;dbprefix}bctobjects_metadata&quot;</span>,
<a name="l00471"></a>00471                                                 <span class="stringliteral">&apos;where&apos;</span> =&gt; <span class="stringliteral">&apos;guid=&apos;</span> . (<span class="keywordtype">int</span>)$this-&gt;guid
<a name="l00472"></a>00472                                         )
<a name="l00473"></a>00473                                 );      
<a name="l00474"></a>00474                                         
<a name="l00475"></a>00475                                 <span class="keywordflow">if</span> ($meta) 
<a name="l00476"></a>00476                                 {
<a name="l00477"></a>00477                                         $this-&gt;<a class="code" href="classBCTObject.html#a3293d3a72bdc82a3d04be79153406e5f" title="Helper method for sending object related events.">__send_object_event</a>(<span class="stringliteral">&apos;deleted&apos;</span>);
<a name="l00478"></a>00478                                         
<a name="l00479"></a>00479                                         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00480"></a>00480                                 }
<a name="l00481"></a>00481                         }
<a name="l00482"></a>00482                         
<a name="l00483"></a>00483                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00484"></a>00484                 }
<a name="l00485"></a>00485                 
<a name="l00491"></a><a class="code" href="classBCTObject.html#a3293d3a72bdc82a3d04be79153406e5f">00491</a>                 <span class="keyword">protected</span> function <a class="code" href="classBCTObject.html#a3293d3a72bdc82a3d04be79153406e5f" title="Helper method for sending object related events.">__send_object_event</a>($event)
<a name="l00492"></a>00492                 {
<a name="l00493"></a>00493                         $event = <a class="code" href="database_8php.html#a0d86f7dc87033ca8db5e4ad4765150fc" title="Sanitise a string for database use.">sanitise_string</a>($event);
<a name="l00494"></a>00494                         
<a name="l00495"></a>00495                         <span class="keywordflow">return</span> <a class="code" href="events_8php.html#a2585abaceefc4160f0704545c3d1b8aa" title="Trigger an event.">trigger_event</a>($this-&gt;<a class="code" href="classBCTObject.html#af1c2c1c5a5106cc161c70a0aeeee024f" title="Return the full type hierarchy of this object.">getTypeHierarchy</a>(), $event, array(<span class="stringliteral">&apos;object&apos;</span> =&gt; $this));
<a name="l00496"></a>00496                 }
<a name="l00497"></a>00497                 
<a name="l00505"></a><a class="code" href="classBCTObject.html#a905fcf00039673c6d1707c1a03de46b1">00505</a>                 <span class="keyword">protected</span> function <a class="code" href="classBCTObject.html#a905fcf00039673c6d1707c1a03de46b1" title="Helper method for triggering object related hooks.">__send_object_hook</a>($hook, $return_value, array $parameters = NULL)
<a name="l00506"></a>00506                 {
<a name="l00507"></a>00507                         $hook = <a class="code" href="database_8php.html#a0d86f7dc87033ca8db5e4ad4765150fc" title="Sanitise a string for database use.">sanitise_string</a>($hook);
<a name="l00508"></a>00508                         <span class="keywordflow">if</span> (!is_array($parameters))
<a name="l00509"></a>00509                                 $parameters = array();
<a name="l00510"></a>00510                         
<a name="l00511"></a>00511                         $parameters[<span class="stringliteral">&apos;object&apos;</span>] = $this;
<a name="l00512"></a>00512                         
<a name="l00513"></a>00513                         <span class="keywordflow">return</span> <a class="code" href="hooks_8php.html#adbdf171d0bd8fc7e7ab203a87fb7a13d" title="Trigger a hook.">trigger_hook</a>($this-&gt;<a class="code" href="classBCTObject.html#af1c2c1c5a5106cc161c70a0aeeee024f" title="Return the full type hierarchy of this object.">getTypeHierarchy</a>(), $hook, $parameters, $return_value);
<a name="l00514"></a>00514                 }
<a name="l00515"></a>00515                 
<a name="l00516"></a>00516                 
<a name="l00517"></a>00517                 <span class="comment">// ITERATOR INTERFACE //////////////////////////////////////////////////////////////</span>
<a name="l00518"></a>00518                 <span class="comment">/*</span>
<a name="l00519"></a>00519 <span class="comment">                 * This lets an entity&apos;s attributes be displayed using foreach as a normal array.</span>
<a name="l00520"></a>00520 <span class="comment">                 * Example: http://www.sitepoint.com/print/php5-standard-library</span>
<a name="l00521"></a>00521 <span class="comment">                 */</span>
<a name="l00522"></a>00522                 
<a name="l00523"></a>00523                 <span class="keyword">private</span> $__iterator_valid = FALSE; 
<a name="l00524"></a>00524                 
<a name="l00525"></a><a class="code" href="classBCTObject.html#afe6634ee9fccedf33070d021b8456d09">00525</a>                 <span class="keyword">public</span> function <a class="code" href="classBCTObject.html#afe6634ee9fccedf33070d021b8456d09">rewind</a>() { $this-&gt;__iterator_valid = (FALSE !== reset($this-&gt;__attributes));    }
<a name="l00526"></a><a class="code" href="classBCTObject.html#a925030a0a53272220355b7e7ed99c432">00526</a>                 <span class="keyword">public</span> function <a class="code" href="classBCTObject.html#a925030a0a53272220355b7e7ed99c432">current</a>()       { <span class="keywordflow">return</span> <a class="code" href="classBCTObject.html#a925030a0a53272220355b7e7ed99c432">current</a>($this-&gt;__attributes);  }       
<a name="l00527"></a><a class="code" href="classBCTObject.html#afac4d3b91e033333133aad365acca6d8">00527</a>                 <span class="keyword">public</span> function <a class="code" href="classBCTObject.html#afac4d3b91e033333133aad365acca6d8">key</a>()   { <span class="keywordflow">return</span> <a class="code" href="classBCTObject.html#afac4d3b91e033333133aad365acca6d8">key</a>($this-&gt;__attributes);      }       
<a name="l00528"></a><a class="code" href="classBCTObject.html#acbbc7eed01ad545ea17a16522f1fc0b8">00528</a>                 <span class="keyword">public</span> function <a class="code" href="classBCTObject.html#acbbc7eed01ad545ea17a16522f1fc0b8">next</a>() { $this-&gt;__iterator_valid = (FALSE !== <a class="code" href="classBCTObject.html#acbbc7eed01ad545ea17a16522f1fc0b8">next</a>($this-&gt;__attributes));  }
<a name="l00529"></a><a class="code" href="classBCTObject.html#a1eed8cdc3137aff50f0f0d6423308ccc">00529</a>                 <span class="keyword">public</span> function <a class="code" href="classBCTObject.html#a1eed8cdc3137aff50f0f0d6423308ccc">valid</a>() {       <span class="keywordflow">return</span> $this-&gt;__iterator_valid;  }
<a name="l00530"></a>00530                 
<a name="l00531"></a>00531                 <span class="comment">// ARRAY ACCESS INTERFACE //////////////////////////////////////////////////////////</span>
<a name="l00532"></a>00532                 <span class="comment">/*</span>
<a name="l00533"></a>00533 <span class="comment">                 * This lets an entity&apos;s attributes be accessed like an associative array.</span>
<a name="l00534"></a>00534 <span class="comment">                 * Example: http://www.sitepoint.com/print/php5-standard-library</span>
<a name="l00535"></a>00535 <span class="comment">                 */</span>
<a name="l00536"></a>00536 
<a name="l00537"></a><a class="code" href="classBCTObject.html#a64757cc52e3d41e8a39436ca2c84f91e">00537</a>                 <span class="keyword">public</span> function <a class="code" href="classBCTObject.html#a64757cc52e3d41e8a39436ca2c84f91e">offsetSet</a>($key, <a class="code" href="input_2date_8php.html#a0f298096f322952a72a50f98a74c7b60">$value</a>) { <span class="keywordflow">if</span> ( array_key_exists($key, $this-&gt;__attributes) ) $this-&gt;__attributes[$key] = <a class="code" href="input_2date_8php.html#a0f298096f322952a72a50f98a74c7b60">$value</a>; } 
<a name="l00538"></a><a class="code" href="classBCTObject.html#ad8117666e371bb502e786381cf6858d8">00538</a>                 <span class="keyword">public</span> function <a class="code" href="classBCTObject.html#ad8117666e371bb502e786381cf6858d8">offsetGet</a>($key) { <span class="keywordflow">if</span> ( array_key_exists($key, $this-&gt;__attributes) ) <span class="keywordflow">return</span> $this-&gt;__attributes[$key]; } 
<a name="l00539"></a><a class="code" href="classBCTObject.html#ae09b1bc7e41d376672743000ff8735e6">00539</a>                 <span class="keyword">public</span> function <a class="code" href="classBCTObject.html#ae09b1bc7e41d376672743000ff8735e6">offsetUnset</a>($key) { <span class="keywordflow">if</span> ( array_key_exists($key, $this-&gt;__attributes) ) $this-&gt;__attributes[$key] = <span class="stringliteral">&quot;&quot;</span>; } 
<a name="l00540"></a><a class="code" href="classBCTObject.html#a77292d9c73b8639fce2293ec3bdff431">00540</a>                 <span class="keyword">public</span> function <a class="code" href="classBCTObject.html#a77292d9c73b8639fce2293ec3bdff431">offsetExists</a>($offset) { <span class="keywordflow">return</span> array_key_exists($offset, $this-&gt;__attributes);  } 
<a name="l00541"></a>00541         }
<a name="l00542"></a>00542 
<a name="l00555"></a><a class="code" href="classBCTDatalist.html">00555</a>         <span class="keyword">class </span><a class="code" href="classBCTDatalist.html" title="Datalist.">BCTDatalist</a> <span class="keyword">implements</span>
<a name="l00556"></a>00556                 Iterator,       <span class="comment">// Override foreach behaviour</span>
<a name="l00557"></a>00557                 ArrayAccess <span class="comment">// Override for array access</span>
<a name="l00558"></a>00558         {
<a name="l00560"></a>00560                 <span class="keyword">private</span> $list = array();
<a name="l00561"></a>00561                 
<a name="l00563"></a>00563                 <span class="keyword">private</span> $page = 0;
<a name="l00564"></a>00564                 
<a name="l00566"></a>00566                 <span class="keyword">private</span> $perpage = 10;
<a name="l00567"></a>00567                 
<a name="l00569"></a>00569                 <span class="keyword">private</span> $total = 0;
<a name="l00570"></a>00570                 
<a name="l00575"></a><a class="code" href="classBCTDatalist.html#a20ddc272dd5723cbb2c75535e02ef8b1">00575</a>                 <span class="keyword">public</span> function <a class="code" href="classBCTDatalist.html#a20ddc272dd5723cbb2c75535e02ef8b1" title="Create a datalist.">__construct</a>(array $items = NULL) 
<a name="l00576"></a>00576                 {
<a name="l00577"></a>00577                         $this-&gt;<a class="code" href="classBCTDatalist.html#adc3c270699ed7e80bfd81e2f6b464c79" title="Set data items.">setItems</a>($items);
<a name="l00578"></a>00578                 }
<a name="l00579"></a>00579                 
<a name="l00585"></a><a class="code" href="classBCTDatalist.html#a97f58d4e820faf45c7af9387fe86a2da">00585</a>                 <span class="keyword">public</span> function <a class="code" href="classBCTDatalist.html#a97f58d4e820faf45c7af9387fe86a2da" title="Copy constructor.">copyDatalist</a>(<a class="code" href="classBCTDatalist.html" title="Datalist.">BCTDatalist</a> $list)
<a name="l00586"></a>00586                 {
<a name="l00587"></a>00587                         $this-&gt;<a class="code" href="classBCTDatalist.html#adc3c270699ed7e80bfd81e2f6b464c79" title="Set data items.">setItems</a>($list-&gt;<a class="code" href="classBCTDatalist.html#a95e9a4aa08c8b25a3f1487c27b8166ea" title="Get the items.">getItems</a>());
<a name="l00588"></a>00588                 }
<a name="l00589"></a>00589                 
<a name="l00595"></a><a class="code" href="classBCTDatalist.html#aac88a7fda92288fad5b846c576126eb0">00595</a>                 <span class="keyword">public</span> function <a class="code" href="classBCTDatalist.html#aac88a7fda92288fad5b846c576126eb0" title="Render list with optional parameters.">draw</a>(array <a class="code" href="default_2data_2lists_2____default_8php.html#a951ef573c9008ec18012f88a5c78b209">$vars</a> = null)
<a name="l00596"></a>00596                 {       
<a name="l00597"></a>00597                         <span class="keywordflow">if</span> (!<a class="code" href="default_2data_2lists_2____default_8php.html#a951ef573c9008ec18012f88a5c78b209">$vars</a>)     <a class="code" href="default_2data_2lists_2____default_8php.html#a951ef573c9008ec18012f88a5c78b209">$vars</a> = array();
<a name="l00598"></a>00598                         <a class="code" href="default_2data_2lists_2____default_8php.html#a951ef573c9008ec18012f88a5c78b209">$vars</a>[<span class="stringliteral">&apos;list&apos;</span>] = $this;
<a name="l00599"></a>00599                         
<a name="l00600"></a>00600                         <a class="code" href="default_2exceptions_2____default_8php.html#a252ba022809910ea710a068fc1bab657">$class</a> = strtolower(get_class($this));
<a name="l00601"></a>00601                         
<a name="l00602"></a>00602                         $content = <a class="code" href="output_8php.html#a73f7c0d588ceab42b328a5e0eca915cf" title="Render a view.">view</a>(<span class="stringliteral">&quot;data/lists/$class&quot;</span>, <a class="code" href="default_2data_2lists_2____default_8php.html#a951ef573c9008ec18012f88a5c78b209">$vars</a>);
<a name="l00603"></a>00603                         <span class="keywordflow">if</span> ($content) 
<a name="l00604"></a>00604                                 <span class="keywordflow">return</span> $content;
<a name="l00605"></a>00605                                 
<a name="l00606"></a>00606                         $content = <a class="code" href="output_8php.html#a73f7c0d588ceab42b328a5e0eca915cf" title="Render a view.">view</a>(<span class="stringliteral">&apos;data/lists/__default&apos;</span>, <a class="code" href="default_2data_2lists_2____default_8php.html#a951ef573c9008ec18012f88a5c78b209">$vars</a>);
<a name="l00607"></a>00607                         <span class="keywordflow">if</span> ($content) 
<a name="l00608"></a>00608                                 <span class="keywordflow">return</span> $content;
<a name="l00609"></a>00609                                 
<a name="l00610"></a>00610                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00611"></a>00611                 }
<a name="l00612"></a>00612                 
<a name="l00616"></a><a class="code" href="classBCTDatalist.html#ae5279defcd791d84eae09baf21aa4564">00616</a>                 <span class="keyword">public</span> function <a class="code" href="classBCTDatalist.html#ae5279defcd791d84eae09baf21aa4564" title="Render datalists using default values.">__toString</a>() { <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classBCTDatalist.html#aac88a7fda92288fad5b846c576126eb0" title="Render list with optional parameters.">draw</a>(); }
<a name="l00617"></a>00617                 
<a name="l00622"></a><a class="code" href="classBCTDatalist.html#adc3c270699ed7e80bfd81e2f6b464c79">00622</a>                 <span class="keyword">public</span> function <a class="code" href="classBCTDatalist.html#adc3c270699ed7e80bfd81e2f6b464c79" title="Set data items.">setItems</a>(array $items) { $this-&gt;list = $items; }
<a name="l00623"></a>00623                 
<a name="l00628"></a><a class="code" href="classBCTDatalist.html#a95e9a4aa08c8b25a3f1487c27b8166ea">00628</a>                 <span class="keyword">public</span> function <a class="code" href="classBCTDatalist.html#a95e9a4aa08c8b25a3f1487c27b8166ea" title="Get the items.">getItems</a>() { <span class="keywordflow">return</span> $this-&gt;list; }
<a name="l00629"></a>00629                 
<a name="l00630"></a><a class="code" href="classBCTDatalist.html#a6f254bdff69235c945049c9470d900db">00630</a>                 <span class="keyword">public</span> function <a class="code" href="classBCTDatalist.html#a6f254bdff69235c945049c9470d900db">setPage</a>($page) { $this-&gt;page = $page; }
<a name="l00631"></a><a class="code" href="classBCTDatalist.html#a9ea1298fb13ceea21960f2a18d4f09ea">00631</a>                 <span class="keyword">public</span> function <a class="code" href="classBCTDatalist.html#a9ea1298fb13ceea21960f2a18d4f09ea">getPage</a>() { <span class="keywordflow">return</span> $this-&gt;page; }
<a name="l00632"></a><a class="code" href="classBCTDatalist.html#af05bbe795632521ac634e820f0bdb57c">00632</a>                 <span class="keyword">public</span> function <a class="code" href="classBCTDatalist.html#af05bbe795632521ac634e820f0bdb57c">setItemsPerPage</a>($perpage) { $this-&gt;perpage = $perpage; } 
<a name="l00633"></a><a class="code" href="classBCTDatalist.html#a328140a2e2f1bae4ed8c66980196bd1e">00633</a>                 <span class="keyword">public</span> function <a class="code" href="classBCTDatalist.html#a328140a2e2f1bae4ed8c66980196bd1e">getItemsPerPage</a>() { <span class="keywordflow">return</span> $this-&gt;perpage; }
<a name="l00634"></a><a class="code" href="classBCTDatalist.html#af761cc5f1fd03fb423cacd6102058605">00634</a>                 <span class="keyword">public</span> function <a class="code" href="classBCTDatalist.html#af761cc5f1fd03fb423cacd6102058605">setTotalItems</a>($total) { $this-&gt;total = $total; }
<a name="l00635"></a><a class="code" href="classBCTDatalist.html#a05da13dcb98e1c0eae4d8e2af3058684">00635</a>                 <span class="keyword">public</span> function <a class="code" href="classBCTDatalist.html#a05da13dcb98e1c0eae4d8e2af3058684">getTotalItems</a>() { <span class="keywordflow">return</span> $this-&gt;total; }
<a name="l00636"></a><a class="code" href="classBCTDatalist.html#afbe60e8f54a44c86a72e3a6d7a08f52b">00636</a>                 <span class="keyword">public</span> function <a class="code" href="classBCTDatalist.html#afbe60e8f54a44c86a72e3a6d7a08f52b">getTotalPages</a>() { <span class="keywordflow">return</span> $this-&gt;perpage!=0 ? ceil($this-&gt;total/$this-&gt;perpage) : 1; <span class="comment">/* If per page is zero, that means offsets and limits weren&apos;t set, so we only have one page */</span> }
<a name="l00637"></a>00637                 
<a name="l00638"></a>00638                 <span class="comment">// ITERATOR INTERFACE //////////////////////////////////////////////////////////////</span>
<a name="l00639"></a>00639                 <span class="comment">/*</span>
<a name="l00640"></a>00640 <span class="comment">                 * This lets an entity&apos;s attributes be displayed using foreach as a normal array.</span>
<a name="l00641"></a>00641 <span class="comment">                 * Example: http://www.sitepoint.com/print/php5-standard-library</span>
<a name="l00642"></a>00642 <span class="comment">                 */</span>
<a name="l00643"></a>00643                 
<a name="l00644"></a>00644                 <span class="keyword">private</span> $__iterator_valid = FALSE; 
<a name="l00645"></a>00645                 
<a name="l00646"></a><a class="code" href="classBCTDatalist.html#a270b2a5ab3bdd2884a8cb16ba6a9d4d9">00646</a>                 <span class="keyword">public</span> function <a class="code" href="classBCTDatalist.html#a270b2a5ab3bdd2884a8cb16ba6a9d4d9">rewind</a>() { $this-&gt;__iterator_valid = (FALSE !== reset($this-&gt;list));    }
<a name="l00647"></a><a class="code" href="classBCTDatalist.html#acab1ebaad2747d4b737648d41f8d4871">00647</a>                 <span class="keyword">public</span> function <a class="code" href="classBCTDatalist.html#acab1ebaad2747d4b737648d41f8d4871">current</a>()       { <span class="keywordflow">return</span> <a class="code" href="classBCTDatalist.html#acab1ebaad2747d4b737648d41f8d4871">current</a>($this-&gt;list);  }       
<a name="l00648"></a><a class="code" href="classBCTDatalist.html#a487c77898329bbbc4fe7a88f53d8166c">00648</a>                 <span class="keyword">public</span> function <a class="code" href="classBCTDatalist.html#a487c77898329bbbc4fe7a88f53d8166c">key</a>()   { <span class="keywordflow">return</span> <a class="code" href="classBCTDatalist.html#a487c77898329bbbc4fe7a88f53d8166c">key</a>($this-&gt;list);      }       
<a name="l00649"></a><a class="code" href="classBCTDatalist.html#ae99e521813829a78a369489191cefc8f">00649</a>                 <span class="keyword">public</span> function <a class="code" href="classBCTDatalist.html#ae99e521813829a78a369489191cefc8f">next</a>() { $this-&gt;__iterator_valid = (FALSE !== <a class="code" href="classBCTDatalist.html#ae99e521813829a78a369489191cefc8f">next</a>($this-&gt;list));  }
<a name="l00650"></a><a class="code" href="classBCTDatalist.html#a637db2505c37d06e10af16dc64607c7d">00650</a>                 <span class="keyword">public</span> function <a class="code" href="classBCTDatalist.html#a637db2505c37d06e10af16dc64607c7d">valid</a>() {       <span class="keywordflow">return</span> $this-&gt;__iterator_valid;  }
<a name="l00651"></a>00651                 
<a name="l00652"></a>00652                 <span class="comment">// ARRAY ACCESS INTERFACE //////////////////////////////////////////////////////////</span>
<a name="l00653"></a>00653                 <span class="comment">/*</span>
<a name="l00654"></a>00654 <span class="comment">                 * This lets an entity&apos;s attributes be accessed like an associative array.</span>
<a name="l00655"></a>00655 <span class="comment">                 * Example: http://www.sitepoint.com/print/php5-standard-library</span>
<a name="l00656"></a>00656 <span class="comment">                 */</span>
<a name="l00657"></a>00657 
<a name="l00658"></a><a class="code" href="classBCTDatalist.html#a7f0c87d37a84816273edc7200c661db9">00658</a>                 <span class="keyword">public</span> function <a class="code" href="classBCTDatalist.html#a7f0c87d37a84816273edc7200c661db9">offsetSet</a>($key, <a class="code" href="input_2date_8php.html#a0f298096f322952a72a50f98a74c7b60">$value</a>) { <span class="keywordflow">if</span> ( array_key_exists($key, $this-&gt;list) ) $this-&gt;list[$key] = <a class="code" href="input_2date_8php.html#a0f298096f322952a72a50f98a74c7b60">$value</a>; } 
<a name="l00659"></a><a class="code" href="classBCTDatalist.html#a5d717c2992939b107b13e6d815225797">00659</a>                 <span class="keyword">public</span> function <a class="code" href="classBCTDatalist.html#a5d717c2992939b107b13e6d815225797">offsetGet</a>($key) { <span class="keywordflow">if</span> ( array_key_exists($key, $this-&gt;list) ) <span class="keywordflow">return</span> $this-&gt;list[$key]; } 
<a name="l00660"></a><a class="code" href="classBCTDatalist.html#aaf0568a9a7635396f5fbd09367a5e2f1">00660</a>                 <span class="keyword">public</span> function <a class="code" href="classBCTDatalist.html#aaf0568a9a7635396f5fbd09367a5e2f1">offsetUnset</a>($key) { <span class="keywordflow">if</span> ( array_key_exists($key, $this-&gt;list) ) $this-&gt;list[$key] = <span class="stringliteral">&quot;&quot;</span>; } 
<a name="l00661"></a><a class="code" href="classBCTDatalist.html#a004e9e43da33e499781ac5870624425b">00661</a>                 <span class="keyword">public</span> function <a class="code" href="classBCTDatalist.html#a004e9e43da33e499781ac5870624425b">offsetExists</a>($offset) { <span class="keywordflow">return</span> array_key_exists($offset, $this-&gt;list);  }
<a name="l00662"></a>00662         }
<a name="l00663"></a>00663         
<a name="l00679"></a><a class="code" href="classRelationship.html">00679</a>         <span class="keyword">abstract</span> <span class="keyword">class </span><a class="code" href="classRelationship.html" title="Relationship class.">Relationship</a> <span class="keyword">extends</span> <a class="code" href="classBCTObject.html" title="Barcamp Transparency Object.">BCTObject</a> 
<a name="l00680"></a>00680         {
<a name="l00684"></a><a class="code" href="classRelationship.html#a4e6d1efde3f45a50262a2e37ae73669c">00684</a>                 <span class="keyword">public</span> function <a class="code" href="classRelationship.html#a4e6d1efde3f45a50262a2e37ae73669c" title="Create a new Relationship.">__construct</a>()
<a name="l00685"></a>00685                 {
<a name="l00686"></a>00686                         <a class="code" href="classRelationship.html#a4e6d1efde3f45a50262a2e37ae73669c" title="Create a new Relationship.">parent::__construct</a>();
<a name="l00687"></a>00687                         
<a name="l00688"></a>00688                         $this-&gt;<a class="code" href="classBCTObject.html#aadd971af998350999c69c372e2d7027b" title="Add a type to the type hierarchy.">setType</a>(<span class="stringliteral">&apos;relationship&apos;</span>);
<a name="l00689"></a>00689                 }       
<a name="l00690"></a>00690                 
<a name="l00697"></a><a class="code" href="classRelationship.html#ad66f849d3ce382a5a984c3d38beef97f">00697</a>                 <span class="keyword">public</span> function <a class="code" href="classRelationship.html#ad66f849d3ce382a5a984c3d38beef97f" title="Construct a relationship between two objects.">link</a>(<a class="code" href="classBCTObject.html" title="Barcamp Transparency Object.">BCTObject</a> $object_one, <a class="code" href="classBCTObject.html" title="Barcamp Transparency Object.">BCTObject</a> $object_two)
<a name="l00698"></a>00698                 {
<a name="l00699"></a>00699                         $guid_one = $object_one-&gt;<a class="code" href="classBCTObject.html#a776243ff928a9e80bd13b61fc05b685b" title="Return a GUID.">getGUID</a>();
<a name="l00700"></a>00700                         $guid_two = $object_two-&gt;<a class="code" href="classBCTObject.html#a776243ff928a9e80bd13b61fc05b685b" title="Return a GUID.">getGUID</a>();
<a name="l00701"></a>00701                         
<a name="l00702"></a>00702                         <span class="keywordflow">if</span> ((!$guid_one) || (!$guid_two))
<a name="l00703"></a>00703                                 <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classRelationshipException.html">RelationshipException</a>(<a class="code" href="language_8php.html#af6dcae4ee39a314ee7d9b340ee789820" title="Echo a translated string.">_echo</a>(<span class="stringliteral">&apos;relationship:create:missingguid&apos;</span>));
<a name="l00704"></a>00704                         
<a name="l00705"></a>00705                         $this-&gt;guid_one = $guid_one;
<a name="l00706"></a>00706                         $this-&gt;guid_two = $guid_two;
<a name="l00707"></a>00707                 }       
<a name="l00708"></a>00708         }
<a name="l00709"></a>00709         
<a name="l00724"></a><a class="code" href="classAnnotation.html">00724</a>         <span class="keyword">abstract</span> <span class="keyword">class </span><a class="code" href="classAnnotation.html" title="An annotation.">Annotation</a> <span class="keyword">extends</span> <a class="code" href="classBCTObject.html" title="Barcamp Transparency Object.">BCTObject</a>
<a name="l00725"></a>00725         {
<a name="l00731"></a><a class="code" href="classAnnotation.html#a5b5ccef69c26e05b81c9bcd4136e67b6">00731</a>                 <span class="keyword">public</span> function <a class="code" href="classAnnotation.html#a5b5ccef69c26e05b81c9bcd4136e67b6" title="Construct a new annotation.">__construct</a>()
<a name="l00732"></a>00732                 {
<a name="l00733"></a>00733                         <a class="code" href="classAnnotation.html#a5b5ccef69c26e05b81c9bcd4136e67b6" title="Construct a new annotation.">parent::__construct</a>();
<a name="l00734"></a>00734                         
<a name="l00735"></a>00735                         $this-&gt;<a class="code" href="classBCTObject.html#aadd971af998350999c69c372e2d7027b" title="Add a type to the type hierarchy.">setType</a>(<span class="stringliteral">&apos;annotation&apos;</span>);
<a name="l00736"></a>00736                         
<a name="l00737"></a>00737                 }
<a name="l00738"></a>00738                 
<a name="l00744"></a><a class="code" href="classAnnotation.html#afc89e1be7e834a36ed07a13810a1e994">00744</a>                 <span class="keyword">public</span> function <a class="code" href="classAnnotation.html#afc89e1be7e834a36ed07a13810a1e994" title="Attach this annotation to an object.">annotate</a>(<a class="code" href="classBCTObject.html" title="Barcamp Transparency Object.">BCTObject</a> $annotating)
<a name="l00745"></a>00745                 {
<a name="l00746"></a>00746                         $guid = $annotating-&gt;<a class="code" href="classBCTObject.html#a776243ff928a9e80bd13b61fc05b685b" title="Return a GUID.">getGUID</a>();
<a name="l00747"></a>00747                         
<a name="l00748"></a>00748                         <span class="keywordflow">if</span> (!$guid)
<a name="l00749"></a>00749                                 <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classAnnotationException.html">AnnotationException</a>(<a class="code" href="language_8php.html#af6dcae4ee39a314ee7d9b340ee789820" title="Echo a translated string.">_echo</a>(<span class="stringliteral">&apos;annotation:create:missingguid&apos;</span>));
<a name="l00750"></a>00750                         
<a name="l00751"></a>00751                         $this-&gt;annotating_guid = $guid;
<a name="l00752"></a>00752                 }
<a name="l00753"></a>00753         }
<a name="l00754"></a>00754         
<a name="l00797"></a><a class="code" href="classObject.html">00797</a>         <span class="keyword">abstract</span> <span class="keyword">class </span><a class="code" href="classObject.html" title="A object in the system.">Object</a> <span class="keyword">extends</span> <a class="code" href="classBCTObject.html" title="Barcamp Transparency Object.">BCTObject</a>
<a name="l00798"></a>00798         {
<a name="l00804"></a><a class="code" href="classObject.html#a9c5fe0d56990a62368be3aa23a4a726e">00804</a>                 <span class="keyword">public</span> function <a class="code" href="classObject.html#a9c5fe0d56990a62368be3aa23a4a726e" title="Object constructor.">__construct</a>() 
<a name="l00805"></a>00805                 { 
<a name="l00806"></a>00806                         <a class="code" href="classObject.html#a9c5fe0d56990a62368be3aa23a4a726e" title="Object constructor.">parent::__construct</a>(); 
<a name="l00807"></a>00807                         
<a name="l00808"></a>00808                         $this-&gt;<a class="code" href="classBCTObject.html#aadd971af998350999c69c372e2d7027b" title="Add a type to the type hierarchy.">setType</a>(<span class="stringliteral">&apos;obj&apos;</span>); 
<a name="l00809"></a>00809                 }
<a name="l00810"></a>00810         }
<a name="l00811"></a>00811         
<a name="l00823"></a><a class="code" href="data_8php.html#a2b18cf1e283ae364d2b846195f6be136">00823</a>         function <a class="code" href="data_8php.html#a2b18cf1e283ae364d2b846195f6be136" title="Object factory callback.">__object_row_factory</a>($row)
<a name="l00824"></a>00824         {
<a name="l00825"></a>00825                 <span class="comment">// Sanity check</span>
<a name="l00826"></a>00826                 <span class="keywordflow">if</span> (
<a name="l00827"></a>00827                         (!($row instanceof stdClass)) ||
<a name="l00828"></a>00828                         (!$row-&gt;guid) ||
<a name="l00829"></a>00829                         (!$row-&gt;handling_class)
<a name="l00830"></a>00830                 )       
<a name="l00831"></a>00831                         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classClassException.html">ClassException</a>(<a class="code" href="language_8php.html#af6dcae4ee39a314ee7d9b340ee789820" title="Echo a translated string.">_echo</a>(<span class="stringliteral">&apos;class:exception:invalidrow&apos;</span>));  
<a name="l00832"></a>00832                         
<a name="l00833"></a>00833                 <a class="code" href="default_2exceptions_2____default_8php.html#a252ba022809910ea710a068fc1bab657">$class</a> = $row-&gt;handling_class;
<a name="l00834"></a>00834                 
<a name="l00835"></a>00835                 <span class="keywordflow">if</span> (class_exists(<a class="code" href="default_2exceptions_2____default_8php.html#a252ba022809910ea710a068fc1bab657">$class</a>))
<a name="l00836"></a>00836                 {
<a name="l00837"></a>00837                         $object = <span class="keyword">new</span> <a class="code" href="default_2exceptions_2____default_8php.html#a252ba022809910ea710a068fc1bab657">$class</a>();
<a name="l00838"></a>00838                         
<a name="l00839"></a>00839                         <span class="keywordflow">if</span> (!($object instanceof <a class="code" href="classBCTObject.html" title="Barcamp Transparency Object.">BCTObject</a>))
<a name="l00840"></a>00840                                 <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classClassException.html">ClassException</a>(<a class="code" href="language_8php.html#af6dcae4ee39a314ee7d9b340ee789820" title="Echo a translated string.">_echo</a>(<span class="stringliteral">&apos;class:exception:invalidbctobject&apos;</span>));
<a name="l00841"></a>00841                                 
<a name="l00842"></a>00842                         <span class="comment">// Populate the new object with data from the already loaded row</span>
<a name="l00843"></a>00843                         $object-&gt;loadFromRow($row);
<a name="l00844"></a>00844                         
<a name="l00845"></a>00845                         <span class="keywordflow">return</span> $object;
<a name="l00846"></a>00846                 }
<a name="l00847"></a>00847                 <span class="keywordflow">else</span>
<a name="l00848"></a>00848                         <a class="code" href="main_8php.html#a6d541b3594a4b28bc1e027a5d677bda1" title="Write a message in the log.">log_echo</a>(sprintf(<a class="code" href="language_8php.html#af6dcae4ee39a314ee7d9b340ee789820" title="Echo a translated string.">_echo</a>(<span class="stringliteral">&apos;class:error:classnotfound&apos;</span>), <a class="code" href="default_2exceptions_2____default_8php.html#a252ba022809910ea710a068fc1bab657">$class</a>), <span class="stringliteral">&apos;ERROR&apos;</span>);  
<a name="l00849"></a>00849                         
<a name="l00850"></a>00850                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00851"></a>00851         }
<a name="l00852"></a>00852         
<a name="l00859"></a><a class="code" href="data_8php.html#aab8e5948d54d74aaebfeea54bf98f3d4">00859</a>         function <a class="code" href="data_8php.html#aab8e5948d54d74aaebfeea54bf98f3d4" title="Construct a new object from GUID.">getObject</a>($guid)
<a name="l00860"></a>00860         {
<a name="l00861"></a>00861                 global <a class="code" href="settings_8example_8php.html#ac32a9d18d73c87d99cdc0547a6c43904" title="Create the CONFIG object.">$CONFIG</a>;
<a name="l00862"></a>00862                 
<a name="l00863"></a>00863                 $obj = <a class="code" href="database_8php.html#ac0751569e8db9476082916ebfca83899" title="Get a single row from database.">db_getdata_row</a>(
<a name="l00864"></a>00864                         array(
<a name="l00865"></a>00865                                 <span class="stringliteral">&apos;select_expr&apos;</span> =&gt; <span class="charliteral">&apos;*&apos;</span>,
<a name="l00866"></a>00866                                 <span class="stringliteral">&apos;table_col&apos;</span> =&gt; <span class="stringliteral">&quot;{$CONFIG-&gt;dbprefix}bctobjects&quot;</span>,
<a name="l00867"></a>00867                                 <span class="stringliteral">&apos;where&apos;</span> =&gt; <span class="stringliteral">&apos;guid=&apos;</span> . (<span class="keywordtype">int</span>)$guid
<a name="l00868"></a>00868                         ), <span class="stringliteral">&apos;__object_row_factory&apos;</span>
<a name="l00869"></a>00869                 );
<a name="l00870"></a>00870                 
<a name="l00871"></a>00871                 <span class="keywordflow">if</span> ($obj)
<a name="l00872"></a>00872                         <span class="keywordflow">return</span> $obj;
<a name="l00873"></a>00873                         
<a name="l00874"></a>00874                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00875"></a>00875         }
<a name="l00876"></a>00876         
<a name="l00893"></a><a class="code" href="data_8php.html#aa8307f0414a898ba987390115c5a95ff">00893</a>         function <a class="code" href="data_8php.html#aa8307f0414a898ba987390115c5a95ff" title="Get an object by a URL.">getObjectByUrl</a>(<a class="code" href="thumbnail_8php.html#acf215f34a917d014776ce684a9ee8909">$url</a>)
<a name="l00894"></a>00894         {
<a name="l00895"></a>00895                 global <a class="code" href="settings_8example_8php.html#ac32a9d18d73c87d99cdc0547a6c43904" title="Create the CONFIG object.">$CONFIG</a>;
<a name="l00896"></a>00896                 
<a name="l00897"></a>00897                 <span class="comment">// Try to get an object by a url</span>
<a name="l00898"></a>00898                 <a class="code" href="action__handler_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a> = <a class="code" href="hooks_8php.html#adbdf171d0bd8fc7e7ab203a87fb7a13d" title="Trigger a hook.">trigger_hook</a>(<span class="stringliteral">&apos;object&apos;</span>, <span class="stringliteral">&apos;getbyurl&apos;</span>, array(<span class="stringliteral">&apos;url&apos;</span> =&gt; <a class="code" href="thumbnail_8php.html#acf215f34a917d014776ce684a9ee8909">$url</a>) );
<a name="l00899"></a>00899                 <span class="keywordflow">if</span> (<a class="code" href="action__handler_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a> instanceof <a class="code" href="classBCTObject.html" title="Barcamp Transparency Object.">BCTObject</a>) <span class="keywordflow">return</span> <a class="code" href="action__handler_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a>;
<a name="l00900"></a>00900                 
<a name="l00901"></a>00901                 <span class="comment">// No luck, so try matching against default url</span>
<a name="l00902"></a>00902                 $match = array();
<a name="l00903"></a>00903                 preg_match(<span class="stringliteral">&quot;/&quot;</span>.str_replace(<span class="charliteral">&apos;/&apos;</span>,<span class="charliteral">&apos;\/&apos;</span>, $CONFIG-&gt;wwwroot).<span class="stringliteral">&quot;object\/([0-9]*)/&quot;</span>, <a class="code" href="thumbnail_8php.html#acf215f34a917d014776ce684a9ee8909">$url</a>, $match);
<a name="l00904"></a>00904                 <a class="code" href="action__handler_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a> = <a class="code" href="data_8php.html#aab8e5948d54d74aaebfeea54bf98f3d4" title="Construct a new object from GUID.">getObject</a>((<span class="keywordtype">int</span>)$match[1]);
<a name="l00905"></a>00905                 <span class="keywordflow">if</span> (<a class="code" href="action__handler_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a>) <span class="keywordflow">return</span> <a class="code" href="action__handler_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a>;
<a name="l00906"></a>00906                 
<a name="l00907"></a>00907                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00908"></a>00908         }
<a name="l00909"></a>00909         
<a name="l00940"></a><a class="code" href="data_8php.html#aa2496d83007763b82c074e22b622a4f3">00940</a>         function <a class="code" href="data_8php.html#aa2496d83007763b82c074e22b622a4f3" title="Construct an array of objects based on a number of parameters.">getObjects</a>($type = null, array $nameValuePairs = null, array $queryParameters = null)
<a name="l00941"></a>00941         {
<a name="l00942"></a>00942                 global <a class="code" href="settings_8example_8php.html#ac32a9d18d73c87d99cdc0547a6c43904" title="Create the CONFIG object.">$CONFIG</a>;
<a name="l00943"></a>00943                 
<a name="l00944"></a>00944                 $where = array();
<a name="l00945"></a>00945                 $joins = array();
<a name="l00946"></a>00946                 $sort_field = <span class="keyword">false</span>;
<a name="l00947"></a>00947                 
<a name="l00948"></a>00948                 <span class="comment">// If we have specified a sort field AND table, then use this - otherwise we attempt autodetection</span>
<a name="l00949"></a>00949                 <span class="comment">// against metadata</span>
<a name="l00950"></a>00950                 <span class="keywordflow">if</span> ((isset($queryParameters[<span class="stringliteral">&apos;order&apos;</span>])) &amp;&amp; (strpos($queryParameters[<span class="stringliteral">&apos;order&apos;</span>],<span class="charliteral">&apos;.&apos;</span>)!==<span class="keyword">false</span>))
<a name="l00951"></a>00951                         $sort_field = $queryParameters[<span class="stringliteral">&apos;order&apos;</span>];
<a name="l00952"></a>00952                 
<a name="l00953"></a>00953                 
<a name="l00954"></a>00954                 <span class="comment">// Find</span>
<a name="l00955"></a>00955                 <span class="keywordflow">if</span> ($type) 
<a name="l00956"></a>00956                 {
<a name="l00957"></a>00957                         $type = <a class="code" href="database_8php.html#a0d86f7dc87033ca8db5e4ad4765150fc" title="Sanitise a string for database use.">sanitise_string</a>($type);
<a name="l00958"></a>00958                         
<a name="l00959"></a>00959                         <span class="keywordflow">if</span> (!is_array($type))
<a name="l00960"></a>00960                                 $type = array($type);
<a name="l00961"></a>00961                                 
<a name="l00962"></a>00962                         $type_array = array();
<a name="l00963"></a>00963                         <span class="keywordflow">foreach</span> ($type as $set)
<a name="l00964"></a>00964                                 $type_array[] = <span class="stringliteral">&quot;o.type like &apos;$set&apos;&quot;</span>;
<a name="l00965"></a>00965                         
<a name="l00966"></a>00966                         $where[] = implode(<span class="stringliteral">&apos; OR &apos;</span>, $type_array);
<a name="l00967"></a>00967                 }
<a name="l00968"></a>00968                 
<a name="l00969"></a>00969                 <span class="comment">// Parameters</span>
<a name="l00970"></a>00970                 <span class="keywordflow">if</span> ($nameValuePairs)
<a name="l00971"></a>00971                 {
<a name="l00972"></a>00972                         $n = 0;
<a name="l00973"></a>00973                         
<a name="l00974"></a>00974                         <span class="keywordflow">foreach</span> ($nameValuePairs as <a class="code" href="input_2formbody_8php.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a> =&gt; <a class="code" href="input_2date_8php.html#a0f298096f322952a72a50f98a74c7b60">$value</a>)
<a name="l00975"></a>00975                         {
<a name="l00976"></a>00976                                 <span class="keywordflow">if</span> (!is_array(<a class="code" href="input_2date_8php.html#a0f298096f322952a72a50f98a74c7b60">$value</a>))
<a name="l00977"></a>00977                                                 <a class="code" href="input_2date_8php.html#a0f298096f322952a72a50f98a74c7b60">$value</a> = array(<span class="charliteral">&apos;=&apos;</span> =&gt; <a class="code" href="input_2date_8php.html#a0f298096f322952a72a50f98a74c7b60">$value</a>);
<a name="l00978"></a>00978                                         
<a name="l00979"></a>00979                                 <span class="keywordflow">foreach</span> (<a class="code" href="input_2date_8php.html#a0f298096f322952a72a50f98a74c7b60">$value</a> as $operator =&gt; <a class="code" href="input_2date_8php.html#a0f298096f322952a72a50f98a74c7b60">$value</a>) 
<a name="l00980"></a>00980                                 {
<a name="l00981"></a>00981                                         <a class="code" href="input_2formbody_8php.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a> = trim(<a class="code" href="database_8php.html#a0d86f7dc87033ca8db5e4ad4765150fc" title="Sanitise a string for database use.">sanitise_string</a>(<a class="code" href="input_2formbody_8php.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a>));
<a name="l00982"></a>00982                                         <a class="code" href="input_2date_8php.html#a0f298096f322952a72a50f98a74c7b60">$value</a> = trim(<a class="code" href="database_8php.html#a0d86f7dc87033ca8db5e4ad4765150fc" title="Sanitise a string for database use.">sanitise_string</a>(<a class="code" href="input_2date_8php.html#a0f298096f322952a72a50f98a74c7b60">$value</a>));
<a name="l00983"></a>00983                                         <span class="keywordflow">if</span> ($operator != <span class="stringliteral">&apos;in&apos;</span>) 
<a name="l00984"></a>00984                                                 <a class="code" href="input_2date_8php.html#a0f298096f322952a72a50f98a74c7b60">$value</a> = <span class="stringliteral">&quot;&apos;$value&apos;&quot;</span>;
<a name="l00985"></a>00985                                         <span class="keywordflow">else</span>
<a name="l00986"></a>00986                                         {
<a name="l00987"></a>00987                                                 <span class="comment">// in</span>
<a name="l00988"></a>00988                                                 <span class="keywordflow">if</span> (is_array(<a class="code" href="input_2date_8php.html#a0f298096f322952a72a50f98a74c7b60">$value</a>))
<a name="l00989"></a>00989                                                         <a class="code" href="input_2date_8php.html#a0f298096f322952a72a50f98a74c7b60">$value</a> = implode(<span class="stringliteral">&quot;&apos;,&apos;&quot;</span>, <a class="code" href="input_2date_8php.html#a0f298096f322952a72a50f98a74c7b60">$value</a>);
<a name="l00990"></a>00990                                                 <a class="code" href="input_2date_8php.html#a0f298096f322952a72a50f98a74c7b60">$value</a> = <span class="stringliteral">&quot;(&apos;$value&apos;)&quot;</span>;
<a name="l00991"></a>00991                                         }
<a name="l00992"></a>00992                                         
<a name="l00993"></a>00993                                         $joins[] = <span class="stringliteral">&quot;{$CONFIG-&gt;dbprefix}bctobjects_metadata m$n ON m$n.guid=o.guid&quot;</span>;
<a name="l00994"></a>00994                                         $where[] = <span class="stringliteral">&quot;(m$n.name=&apos;$name&apos; and m$n.value $operator $value)&quot;</span>;
<a name="l00995"></a>00995                                                 
<a name="l00996"></a>00996                                         $n++;
<a name="l00997"></a>00997                                 }
<a name="l00998"></a>00998                         }
<a name="l00999"></a>00999                 }
<a name="l01000"></a>01000                 
<a name="l01001"></a>01001                 <span class="comment">// Ordering</span>
<a name="l01002"></a>01002                 $orderby = <a class="code" href="database_8php.html#a0d86f7dc87033ca8db5e4ad4765150fc" title="Sanitise a string for database use.">sanitise_string</a>($queryParameters[<span class="stringliteral">&apos;orderby&apos;</span>]);
<a name="l01003"></a>01003                 <span class="keywordflow">if</span> ($orderby)
<a name="l01004"></a>01004                 {
<a name="l01005"></a>01005                         <span class="comment">// Is it a main field</span>
<a name="l01006"></a>01006                         <span class="keywordflow">if</span> (in_array($orderby, array(<span class="stringliteral">&apos;guid&apos;</span>,<span class="stringliteral">&apos;type&apos;</span>,<span class="stringliteral">&apos;handling_class&apos;</span>,<span class="stringliteral">&apos;created_ts&apos;</span>)))
<a name="l01007"></a>01007                                 $sort_field = <span class="stringliteral">&quot;o.$orderby &quot;</span>;
<a name="l01008"></a>01008                         <span class="keywordflow">else</span>
<a name="l01009"></a>01009                         {
<a name="l01010"></a>01010                                 $joins[] = <span class="stringliteral">&quot;{$CONFIG-&gt;dbprefix}bctobjects_metadata sort ON sort.guid=o.guid&quot;</span>;
<a name="l01011"></a>01011                                 $where[] = <span class="stringliteral">&quot;sort.name=&apos;$orderby&apos;&quot;</span>;
<a name="l01012"></a>01012                                 $sort_field = <span class="stringliteral">&quot;sort.value&quot;</span>;
<a name="l01013"></a>01013                         }
<a name="l01014"></a>01014                 }
<a name="l01015"></a>01015                 
<a name="l01016"></a>01016                 <span class="comment">// Get data</span>
<a name="l01017"></a>01017                 $query = array(
<a name="l01018"></a>01018                                 <span class="stringliteral">&apos;select_expr&apos;</span> =&gt; <span class="stringliteral">&apos;o.*&apos;</span>,
<a name="l01019"></a>01019                                 <span class="stringliteral">&apos;table_col&apos;</span> =&gt; <span class="stringliteral">&quot;{$CONFIG-&gt;dbprefix}bctobjects o&quot;</span>,
<a name="l01020"></a>01020                                 <span class="stringliteral">&apos;where&apos;</span> =&gt; $where,
<a name="l01021"></a>01021                                 <span class="stringliteral">&apos;joins&apos;</span> =&gt; $joins,
<a name="l01022"></a>01022                         );
<a name="l01023"></a>01023                         
<a name="l01024"></a>01024                 <span class="keywordflow">if</span> (isset($queryParameters[<span class="stringliteral">&apos;limit&apos;</span>])) $query[<span class="stringliteral">&apos;limit&apos;</span>] = (int)$queryParameters[<span class="stringliteral">&apos;limit&apos;</span>];
<a name="l01025"></a>01025                 <span class="keywordflow">if</span> (isset($queryParameters[<span class="stringliteral">&apos;offset&apos;</span>])) $query[<span class="stringliteral">&apos;offset&apos;</span>] = (<span class="keywordtype">int</span>)$queryParameters[<span class="stringliteral">&apos;offset&apos;</span>];
<a name="l01026"></a>01026                 
<a name="l01027"></a>01027                 <span class="comment">// Sorting </span>
<a name="l01028"></a>01028                 <span class="keywordflow">if</span> (!$sort_field)
<a name="l01029"></a>01029                 {
<a name="l01030"></a>01030                         <span class="comment">// If not sort field then use default</span>
<a name="l01031"></a>01031                         $sort_field = <span class="stringliteral">&apos;o.created_ts&apos;</span>;
<a name="l01032"></a>01032                 }
<a name="l01033"></a>01033                 
<a name="l01034"></a>01034                 <span class="keywordflow">if</span> ($sort_field) $query[<span class="stringliteral">&apos;orderby&apos;</span>] = <a class="code" href="database_8php.html#a0d86f7dc87033ca8db5e4ad4765150fc" title="Sanitise a string for database use.">sanitise_string</a>($sort_field);
<a name="l01035"></a>01035                 
<a name="l01036"></a>01036                 <span class="comment">// Sort order</span>
<a name="l01037"></a>01037                 <span class="keywordflow">if</span> (isset($queryParameters[<span class="stringliteral">&apos;order&apos;</span>])) $query[<span class="stringliteral">&apos;order&apos;</span>] = <a class="code" href="database_8php.html#a0d86f7dc87033ca8db5e4ad4765150fc" title="Sanitise a string for database use.">sanitise_string</a>($queryParameters[<span class="stringliteral">&apos;order&apos;</span>]);
<a name="l01038"></a>01038                 
<a name="l01039"></a>01039                 
<a name="l01040"></a>01040                 $return = <a class="code" href="database_8php.html#a661228a8074ffb96cc1db01f064f0f64" title="Return a query with multiple return results.">db_getdata</a>($query, <span class="stringliteral">&apos;__object_row_factory&apos;</span>);
<a name="l01041"></a>01041                 
<a name="l01042"></a>01042                 <span class="keywordflow">if</span> ($return) {
<a name="l01043"></a>01043                         $list = <span class="keyword">false</span>;
<a name="l01044"></a>01044                         
<a name="l01045"></a>01045                         <span class="comment">// Construct datalist</span>
<a name="l01046"></a>01046                         <span class="keywordflow">if</span> (isset($queryParameters[<span class="stringliteral">&apos;datalist&apos;</span>]))
<a name="l01047"></a>01047                         {
<a name="l01048"></a>01048                                 $datalist = $queryParameters[<span class="stringliteral">&apos;datalist&apos;</span>];
<a name="l01049"></a>01049                                 <span class="keywordflow">if</span> (class_exists($datalist))
<a name="l01050"></a>01050                                         $list = <span class="keyword">new</span> $datalist($return);
<a name="l01051"></a>01051                         }
<a name="l01052"></a>01052                         
<a name="l01053"></a>01053                         <span class="keywordflow">if</span> (!$list) $list = <span class="keyword">new</span> <a class="code" href="classBCTDatalist.html" title="Datalist.">BCTDatalist</a>($return);
<a name="l01054"></a>01054                         <span class="keywordflow">if</span> ($list) {
<a name="l01055"></a>01055                                 
<a name="l01056"></a>01056                                 <span class="comment">// Autolist</span>
<a name="l01057"></a>01057                                 global $__PAGE_CONTAINS_LIST;
<a name="l01058"></a>01058                                 $__PAGE_CONTAINS_LIST = <span class="keyword">true</span>;
<a name="l01059"></a>01059                                 
<a name="l01060"></a>01060                                 <span class="comment">// Now, lets set some variables needed for pagination</span>
<a name="l01061"></a>01061                                 $num_items = count($return);
<a name="l01062"></a>01062                                 <a class="code" href="page__handler_8php.html#a0a44e6760141442bb439b1ab1395d8ff">$page</a> = $query[<span class="stringliteral">&apos;offset&apos;</span>] &gt; 0 ? ceil($query[<span class="stringliteral">&apos;offset&apos;</span>] / $query[<span class="stringliteral">&apos;limit&apos;</span>])+1 : 1;
<a name="l01063"></a>01063                                 $numperpage = isset($query[<span class="stringliteral">&apos;limit&apos;</span>]) ? $query[<span class="stringliteral">&apos;limit&apos;</span>] : 0;
<a name="l01064"></a>01064                                 $total = ((<a class="code" href="page__handler_8php.html#a0a44e6760141442bb439b1ab1395d8ff">$page</a> == 0) &amp;&amp; ($num_items&lt;$numperpage)) ? $num_items : ($queryParameters[<span class="stringliteral">&apos;no_count&apos;</span>] ? $num_items : <a class="code" href="data_8php.html#ae3f9f06f093c3b845d9199369435106b" title="Count the number of objects returned by a query.">getObjectsCount</a>($type, $nameValuePairs, $queryParameters));
<a name="l01065"></a>01065                         
<a name="l01066"></a>01066                                 $list-&gt;setPage(<a class="code" href="page__handler_8php.html#a0a44e6760141442bb439b1ab1395d8ff">$page</a>);
<a name="l01067"></a>01067                                 $list-&gt;setItemsPerPage($numperpage);
<a name="l01068"></a>01068                                 $list-&gt;setTotalItems($total);
<a name="l01069"></a>01069                                 
<a name="l01070"></a>01070                                 <span class="comment">// Return list</span>
<a name="l01071"></a>01071                                 <span class="keywordflow">return</span> $list;
<a name="l01072"></a>01072                         }
<a name="l01073"></a>01073                 }
<a name="l01074"></a>01074 
<a name="l01075"></a>01075                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01076"></a>01076         }
<a name="l01077"></a>01077         
<a name="l01087"></a><a class="code" href="data_8php.html#ae3f9f06f093c3b845d9199369435106b">01087</a>         function <a class="code" href="data_8php.html#ae3f9f06f093c3b845d9199369435106b" title="Count the number of objects returned by a query.">getObjectsCount</a>($type = <span class="stringliteral">&quot;&quot;</span>, array $nameValuePairs = null, array $queryParameters = null)
<a name="l01088"></a>01088         {
<a name="l01089"></a>01089                 global <a class="code" href="settings_8example_8php.html#ac32a9d18d73c87d99cdc0547a6c43904" title="Create the CONFIG object.">$CONFIG</a>;
<a name="l01090"></a>01090                 
<a name="l01091"></a>01091                 $where = array();
<a name="l01092"></a>01092                 $joins = array();
<a name="l01093"></a>01093                 
<a name="l01094"></a>01094                 <span class="comment">// Find</span>
<a name="l01095"></a>01095                 <span class="keywordflow">if</span> ($type) 
<a name="l01096"></a>01096                 {
<a name="l01097"></a>01097                         $type = <a class="code" href="database_8php.html#a0d86f7dc87033ca8db5e4ad4765150fc" title="Sanitise a string for database use.">sanitise_string</a>($type);
<a name="l01098"></a>01098                         
<a name="l01099"></a>01099                         <span class="keywordflow">if</span> (!is_array($type))
<a name="l01100"></a>01100                                 $type = array($type);
<a name="l01101"></a>01101                                 
<a name="l01102"></a>01102                         $type_array = array();
<a name="l01103"></a>01103                         <span class="keywordflow">foreach</span> ($type as $set)
<a name="l01104"></a>01104                                 $type_array[] = <span class="stringliteral">&quot;o.type like &apos;$set&apos;&quot;</span>;
<a name="l01105"></a>01105                         
<a name="l01106"></a>01106                         $where[] = implode(<span class="stringliteral">&apos; OR &apos;</span>, $type_array);
<a name="l01107"></a>01107                 }
<a name="l01108"></a>01108                 
<a name="l01109"></a>01109                 <span class="comment">// Parameters</span>
<a name="l01110"></a>01110                 <span class="keywordflow">if</span> ($nameValuePairs)
<a name="l01111"></a>01111                 {
<a name="l01112"></a>01112                         $n = 0;
<a name="l01113"></a>01113                         
<a name="l01114"></a>01114                         <span class="keywordflow">foreach</span> ($nameValuePairs as <a class="code" href="input_2formbody_8php.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a> =&gt; <a class="code" href="input_2date_8php.html#a0f298096f322952a72a50f98a74c7b60">$value</a>)
<a name="l01115"></a>01115                         {
<a name="l01116"></a>01116                                 <span class="keywordflow">if</span> (!is_array(<a class="code" href="input_2date_8php.html#a0f298096f322952a72a50f98a74c7b60">$value</a>))
<a name="l01117"></a>01117                                                 <a class="code" href="input_2date_8php.html#a0f298096f322952a72a50f98a74c7b60">$value</a> = array(<span class="charliteral">&apos;=&apos;</span> =&gt; <a class="code" href="input_2date_8php.html#a0f298096f322952a72a50f98a74c7b60">$value</a>);
<a name="l01118"></a>01118                                         
<a name="l01119"></a>01119                                 <span class="keywordflow">foreach</span> (<a class="code" href="input_2date_8php.html#a0f298096f322952a72a50f98a74c7b60">$value</a> as $operator =&gt; <a class="code" href="input_2date_8php.html#a0f298096f322952a72a50f98a74c7b60">$value</a>) 
<a name="l01120"></a>01120                                 {
<a name="l01121"></a>01121                                         <a class="code" href="input_2formbody_8php.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a> = trim(<a class="code" href="database_8php.html#a0d86f7dc87033ca8db5e4ad4765150fc" title="Sanitise a string for database use.">sanitise_string</a>(<a class="code" href="input_2formbody_8php.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a>));
<a name="l01122"></a>01122                                         <a class="code" href="input_2date_8php.html#a0f298096f322952a72a50f98a74c7b60">$value</a> = trim(<a class="code" href="database_8php.html#a0d86f7dc87033ca8db5e4ad4765150fc" title="Sanitise a string for database use.">sanitise_string</a>(<a class="code" href="input_2date_8php.html#a0f298096f322952a72a50f98a74c7b60">$value</a>));
<a name="l01123"></a>01123                                         
<a name="l01124"></a>01124                                         $joins[] = <span class="stringliteral">&quot;{$CONFIG-&gt;dbprefix}bctobjects_metadata m$n ON m$n.guid=o.guid&quot;</span>;
<a name="l01125"></a>01125                                         $where[] = <span class="stringliteral">&quot;(m$n.name=&apos;$name&apos; and m$n.value $operator &apos;$value&apos;)&quot;</span>;
<a name="l01126"></a>01126                                                 
<a name="l01127"></a>01127                                         $n++;
<a name="l01128"></a>01128                                 }
<a name="l01129"></a>01129                         }
<a name="l01130"></a>01130                 }
<a name="l01131"></a>01131                 
<a name="l01132"></a>01132                 $query = array(
<a name="l01133"></a>01133                         <span class="stringliteral">&apos;select_expr&apos;</span> =&gt; <span class="charliteral">&apos;*&apos;</span>,
<a name="l01134"></a>01134                         <span class="stringliteral">&apos;table_col&apos;</span> =&gt; <span class="stringliteral">&quot;{$CONFIG-&gt;dbprefix}bctobjects o&quot;</span>,
<a name="l01135"></a>01135                         <span class="stringliteral">&apos;where&apos;</span> =&gt; $where,
<a name="l01136"></a>01136                         <span class="stringliteral">&apos;joins&apos;</span> =&gt; $joins,
<a name="l01137"></a>01137                         <span class="stringliteral">&apos;select_func&apos;</span> =&gt; <span class="stringliteral">&apos;COUNT&apos;</span>,
<a name="l01138"></a>01138                 );
<a name="l01139"></a>01139         
<a name="l01140"></a>01140                 $return = <a class="code" href="database_8php.html#ac0751569e8db9476082916ebfca83899" title="Get a single row from database.">db_getdata_row</a>($query);
<a name="l01141"></a>01141                 
<a name="l01142"></a>01142                 <span class="keywordflow">if</span> ($return) 
<a name="l01143"></a>01143                         <span class="keywordflow">return</span> $return-&gt;select_func_result;
<a name="l01144"></a>01144 
<a name="l01145"></a>01145                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01146"></a>01146                 
<a name="l01147"></a>01147         }
<a name="l01148"></a>01148         
</pre></div></div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr size="1"/><address style="text-align: right;"><small>Generated on Mon Dec 19 17:37:21 2011 for BarcampTransparency by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
